<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>××‘×—×Ÿ: ×”×¤×¢×œ×ª ×—×™×™×©×Ÿ ××¨×—×§</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;800;900&family=Space+Mono:wght@400;700&display=swap');

  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --card: #1a2235;
    --border: #2a3a55;
    --accent: #00d4ff;
    --accent2: #7c3aed;
    --accent3: #10b981;
    --warn: #f59e0b;
    --danger: #ef4444;
    --text: #e8f0fe;
    --text-muted: #6b7fa3;
    --correct: #10b981;
    --wrong: #ef4444;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Heebo', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image: 
      radial-gradient(ellipse at 20% 20%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  /* HEADER */
  .header {
    text-align: center;
    padding: 40px 20px 30px;
    position: relative;
  }
  .header::before {
    content: '';
    position: absolute;
    top: 0; left: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 40px;
    background: linear-gradient(to bottom, transparent, var(--accent));
  }
  .header-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent2), var(--accent));
    padding: 4px 16px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }
  .header h1 {
    font-size: clamp(28px, 5vw, 42px);
    font-weight: 900;
    background: linear-gradient(135deg, var(--accent), #a78bfa, var(--accent3));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
    margin-bottom: 8px;
  }
  .header p {
    color: var(--text-muted);
    font-size: 14px;
  }

  /* PROGRESS */
  .progress-bar-wrap {
    background: var(--border);
    border-radius: 10px;
    height: 6px;
    margin: 20px 0;
    overflow: hidden;
  }
  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent2), var(--accent));
    border-radius: 10px;
    transition: width 0.4s ease;
  }
  .progress-info {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  /* SCREEN: NAME */
  .screen { display: none; }
  .screen.active { display: block; animation: fadeIn 0.4s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .name-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 48px 40px;
    text-align: center;
    margin-top: 20px;
    position: relative;
    overflow: hidden;
  }
  .name-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent2), var(--accent), var(--accent3));
  }
  .sensor-icon {
    font-size: 64px;
    margin-bottom: 16px;
    display: block;
    filter: drop-shadow(0 0 20px rgba(0,212,255,0.5));
  }
  .name-card h2 {
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 8px;
    color: var(--text);
  }
  .name-card p {
    color: var(--text-muted);
    margin-bottom: 32px;
    font-size: 14px;
    line-height: 1.6;
  }
  .name-input {
    width: 100%;
    padding: 16px 20px;
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-family: 'Heebo', sans-serif;
    font-size: 16px;
    text-align: right;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
    margin-bottom: 24px;
  }
  .name-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,212,255,0.15);
  }
  .name-input::placeholder { color: var(--text-muted); }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 32px;
    border-radius: 12px;
    font-family: 'Heebo', sans-serif;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--accent2), var(--accent));
    color: white;
    width: 100%;
    justify-content: center;
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,212,255,0.3); }
  .btn-primary:active { transform: translateY(0); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .btn-export {
    background: linear-gradient(135deg, var(--accent3), #0d9488);
    color: white;
    margin-top: 16px;
    width: 100%;
    justify-content: center;
  }
  .btn-export:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(16,185,129,0.3); }

  /* SECTION HEADER */
  .section-header {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    position: relative;
    overflow: hidden;
  }
  .section-header::before {
    content: '';
    position: absolute;
    right: 0; top: 0; bottom: 0;
    width: 4px;
  }
  .section-1 .section-header::before { background: var(--accent); }
  .section-2 .section-header::before { background: var(--accent2); }
  .section-3 .section-header::before { background: var(--accent3); }

  .section-num {
    width: 48px; height: 48px;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; font-weight: 900;
    flex-shrink: 0;
  }
  .section-1 .section-num { background: rgba(0,212,255,0.15); color: var(--accent); }
  .section-2 .section-num { background: rgba(124,58,237,0.15); color: var(--accent2); }
  .section-3 .section-num { background: rgba(16,185,129,0.15); color: var(--accent3); }

  .section-info h3 { font-size: 16px; font-weight: 800; }
  .section-info p { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

  /* QUESTION CARD */
  .question-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 16px;
    transition: border-color 0.2s;
  }
  .question-card:hover { border-color: rgba(0,212,255,0.3); }

  .q-number {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 12px;
    text-transform: uppercase;
  }
  .q-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
  }
  .question-text {
    font-size: 17px;
    font-weight: 600;
    line-height: 1.6;
    margin-bottom: 20px;
    color: var(--text);
  }

  .options-grid {
    display: grid;
    gap: 10px;
  }
  .option-btn {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 14px 16px;
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    text-align: right;
    font-family: 'Heebo', sans-serif;
    font-size: 14px;
    color: var(--text);
    transition: all 0.2s;
    width: 100%;
    line-height: 1.5;
  }
  .option-btn span:last-child {
    unicode-bidi: plaintext;
  }
  .opt-ltr {
    direction: ltr;
    text-align: left;
    font-family: 'Space Mono', monospace;
    font-size: 13px;
  }
  .option-btn:hover:not(:disabled) {
    border-color: rgba(0,212,255,0.5);
    background: rgba(0,212,255,0.05);
    transform: translateX(-2px);
  }
  .option-btn:disabled { cursor: default; }
  .option-btn.selected { border-color: var(--accent); background: rgba(0,212,255,0.08); }
  .option-btn.correct { border-color: var(--correct); background: rgba(16,185,129,0.1); }
  .option-btn.wrong { border-color: var(--wrong); background: rgba(239,68,68,0.1); }

  .opt-letter {
    width: 26px; height: 26px;
    border-radius: 8px;
    background: var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
    flex-shrink: 0;
    font-family: 'Space Mono', monospace;
    transition: all 0.2s;
  }
  .option-btn.selected .opt-letter { background: var(--accent); color: #000; }
  .option-btn.correct .opt-letter { background: var(--correct); color: white; }
  .option-btn.wrong .opt-letter { background: var(--wrong); color: white; }

  .feedback {
    margin-top: 12px;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 13px;
    display: none;
  }
  .feedback.show { display: flex; align-items: center; gap: 8px; }
  .feedback.correct { background: rgba(16,185,129,0.1); color: var(--correct); border: 1px solid rgba(16,185,129,0.3); }
  .feedback.wrong { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }

  /* NAV */
  .nav-buttons {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    justify-content: space-between;
  }
  .btn-nav {
    flex: 1;
    padding: 14px;
    border-radius: 12px;
    font-family: 'Heebo', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    border: 1.5px solid var(--border);
    background: var(--surface);
    color: var(--text);
    transition: all 0.2s;
  }
  .btn-nav:hover { border-color: var(--accent); color: var(--accent); }
  .btn-nav.next {
    background: linear-gradient(135deg, var(--accent2), var(--accent));
    border-color: transparent;
    color: white;
  }
  .btn-nav.next:hover { box-shadow: 0 6px 20px rgba(0,212,255,0.3); transform: translateY(-1px); }

  /* RESULTS */
  .results-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 48px 40px;
    text-align: center;
    margin-top: 20px;
    position: relative;
    overflow: hidden;
  }
  .results-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent3), var(--accent), var(--accent2));
  }

  .score-ring {
    width: 160px; height: 160px;
    margin: 0 auto 24px;
    position: relative;
  }
  .score-ring svg { transform: rotate(-90deg); }
  .score-ring-bg { fill: none; stroke: var(--border); stroke-width: 10; }
  .score-ring-fill {
    fill: none;
    stroke-width: 10;
    stroke-linecap: round;
    stroke-dasharray: 440;
    stroke-dashoffset: 440;
    transition: stroke-dashoffset 1.5s ease;
  }
  .score-center {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  .score-num {
    font-size: 36px;
    font-weight: 900;
    background: linear-gradient(135deg, var(--accent), var(--accent3));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .score-label { font-size: 11px; color: var(--text-muted); }

  .results-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
  .results-subtitle { color: var(--text-muted); font-size: 14px; margin-bottom: 32px; }

  .score-breakdown {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 32px;
  }
  .breakdown-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
  }
  .breakdown-item .val {
    font-size: 22px; font-weight: 800;
    margin-bottom: 4px;
  }
  .breakdown-item .lbl { font-size: 11px; color: var(--text-muted); }
  .breakdown-item:nth-child(1) .val { color: var(--accent); }
  .breakdown-item:nth-child(2) .val { color: var(--correct); }
  .breakdown-item:nth-child(3) .val { color: var(--danger); }

  .answers-review {
    margin-top: 32px;
    text-align: right;
  }
  .answers-review h3 {
    font-size: 16px; font-weight: 700;
    margin-bottom: 16px;
    color: var(--text-muted);
    text-align: center;
    border-top: 1px solid var(--border);
    padding-top: 24px;
  }
  .review-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 8px;
    background: var(--surface);
    border: 1px solid var(--border);
  }
  .review-icon { font-size: 16px; flex-shrink: 0; }
  .review-q { font-size: 13px; }
  .review-q .q-label { color: var(--text-muted); font-size: 11px; }
  .review-correct { border-color: rgba(16,185,129,0.3); }
  .review-wrong { border-color: rgba(239,68,68,0.3); }

  /* FLOATING PARTICLES */
  .particle {
    position: fixed;
    pointer-events: none;
    border-radius: 50%;
    opacity: 0.15;
    animation: float linear infinite;
  }
  @keyframes float {
    0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
    10% { opacity: 0.15; }
    90% { opacity: 0.15; }
    100% { transform: translateY(-100px) rotate(720deg); opacity: 0; }
  }
</style>
</head>
<body>

<!-- Particles -->
<div id="particles"></div>

<div class="container">
  <div class="header">
    <div class="header-badge">ğŸ“¡ Arduino Lab</div>
    <h1>×”×¤×¢×œ×ª ×—×™×™×©×Ÿ ××¨×—×§</h1>
    <p>××‘×—×Ÿ ×”×¢×¨×›×” â€” 15 ×©××œ×•×ª | 3 ×—×œ×§×™×</p>
  </div>

  <!-- SCREEN: NAME -->
  <div class="screen active" id="screen-name">
    <div class="name-card">
      <span class="sensor-icon">ğŸ¯</span>
      <h2>×‘×¨×•×›×™× ×”×‘××™× ×œ××‘×—×Ÿ!</h2>
      <p>
        ×”××‘×—×Ÿ ×›×•×œ×œ 15 ×©××œ×•×ª ×××¨×™×§××™×•×ª ×”××—×•×œ×§×•×ª ×œ×©×œ×•×©×” ×—×œ×§×™×:<br>
        ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™ | LED ×•×‘×§×¨×” | ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª
      </p>
      <input type="text" class="name-input" id="studentName" placeholder="×”×›× ×¡/×™ ××ª ×©××š ×”××œ×..." autocomplete="off">
      <button class="btn btn-primary" id="startBtn" onclick="startQuiz()" disabled>
        â–¶ ×”×ª×—×œ ××‘×—×Ÿ
      </button>
    </div>
  </div>

  <!-- SCREEN: QUIZ -->
  <div class="screen" id="screen-quiz">
    <div class="progress-info">
      <span id="progressText">×©××œ×” 1 ××ª×•×š 15</span>
      <span id="sectionText">×—×œ×§ ×¨××©×•×Ÿ</span>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
    </div>
    <div id="quizContent"></div>
    <div class="nav-buttons">
      <button class="btn-nav next" id="nextBtn" onclick="nextQuestion()" disabled>×”××©×š â†</button>
    </div>
  </div>

  <!-- SCREEN: RESULTS -->
  <div class="screen" id="screen-results">
    <div class="results-card">
      <div class="score-ring">
        <svg viewBox="0 0 160 160" width="160" height="160">
          <circle class="score-ring-bg" cx="80" cy="80" r="70"/>
          <circle class="score-ring-fill" id="scoreRing" cx="80" cy="80" r="70"/>
        </svg>
        <div class="score-center">
          <div class="score-num" id="scoreNum">0</div>
          <div class="score-label">× ×™×§×•×“</div>
        </div>
      </div>
      <div class="results-title" id="resultsTitle">×ª×•×¦××•×ª ×”××‘×—×Ÿ</div>
      <div class="results-subtitle" id="resultsSubtitle"></div>

      <div class="score-breakdown">
        <div class="breakdown-item">
          <div class="val" id="scorePercent">0%</div>
          <div class="lbl">××—×•×– ×”×¦×œ×—×”</div>
        </div>
        <div class="breakdown-item">
          <div class="val" id="scoreCorrect">0</div>
          <div class="lbl">×ª×©×•×‘×•×ª × ×›×•× ×•×ª</div>
        </div>
        <div class="breakdown-item">
          <div class="val" id="scoreWrong">0</div>
          <div class="lbl">×ª×©×•×‘×•×ª ×©×’×•×™×•×ª</div>
        </div>
      </div>

      <button class="btn btn-export" onclick="exportToExcel()">
        ğŸ“¤ ×”×’×© ××ª ×”××‘×—×Ÿ
      </button>

      <div class="answers-review" id="answersReview"></div>
    </div>
  </div>
</div>

<script>
// ================== QUESTIONS ==================
const questions = [
  // --- PART 1: ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™ ---
  {
    part: 1, partName: '×—×œ×§ ×¨××©×•×Ÿ â€” ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™',
    q: '×›×™×¦×“ ×¤×•×¢×œ ×—×™×™×©×Ÿ ××¨×—×§ ××•×œ×˜×¨×”-×¡×•× ×™?',
    opts: [
      '×©×•×œ×— ×’×œ ××•×¨ ×•××•×“×“ ××ª ×–××Ÿ ×”×—×–×¨×” ×©×œ×•',
      '×©×•×œ×— ×’×œ ×§×•×œ (××•×œ×˜×¨×”-×¡×•× ×™) ×•××•×“×“ ××ª ×–××Ÿ ×”×—×–×¨×” ×©×œ ×”×’×œ ××”×¢×¦×',
      '××•×“×“ ××ª ×¢×•×¦××ª ×”×©×“×” ×”×—×©××œ×™ ×œ×™×“ ×”×¢×¦×',
      '××–×”×” ×¦×‘×¢ ×©×œ ×¢×¦× ×•××—×©×‘ ××¨×—×§ ×œ×¤×™×•'
    ],
    correct: 1,
    explanation: '×—×™×™×©×Ÿ HC-SR04 ×©×•×œ×— ×¤×•×œ×¡×™× ××•×œ×˜×¨×”-×¡×•× ×™×™× ×•××•×“×“ ×–××Ÿ ×”×œ×•×š-×—×–×•×¨ ×œ×—×™×©×•×‘ ××¨×—×§.'
  },
  {
    part: 1, partName: '×—×œ×§ ×¨××©×•×Ÿ â€” ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™',
    q: '××” ×”× ×•×¡×—×” ×”× ×›×•× ×” ×œ×—×™×©×•×‘ ××¨×—×§ ×‘×××¦×¢×•×ª ×—×™×™×©×Ÿ ××•×œ×˜×¨×”-×¡×•× ×™?',
    opts: [
      '××¨×—×§ = ××”×™×¨×•×ª ×§×•×œ Ã— ×–××Ÿ',
      '××¨×—×§ = ××”×™×¨×•×ª ×§×•×œ Ã— ×–××Ÿ / 2',
      '××¨×—×§ = ×–××Ÿ / ××”×™×¨×•×ª ×§×•×œ',
      '××¨×—×§ = (××”×™×¨×•×ª ×§×•×œ + ×–××Ÿ) / 2'
    ],
    correct: 1,
    explanation: '××—×œ×§×™× ×‘-2 ×›×™ ×”×’×œ ×¢×•×‘×¨ ×”×œ×•×š-×•×—×–×•×¨, ×•×× ×—× ×• ×¨×•×¦×™× ×¨×§ ××ª ××—×¦×™×ª ×”××¡×œ×•×œ.'
  },
  {
    part: 1, partName: '×—×œ×§ ×¨××©×•×Ÿ â€” ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™',
    q: '×œ××™×œ×• ×”×™×“×§×™× ×‘××¨×“×•××™× ×• ×—×™×‘×¨× ×• ××ª ×—×™×™×©×Ÿ ×”××¨×—×§ ×‘× ×™×¡×•×™?',
    opts: [
      'D2 ×•-D3',
      'D9 ×•-D10',
      'A0 ×•-A1',
      'D13 ×•-GND'
    ],
    correct: 2,
    explanation: '×¢×œ ×¤×™ ×”× ×™×¡×•×™, ×—×™×™×©×Ÿ ×”××¨×—×§ ×—×•×‘×¨ ×œ×”×™×“×§×™× A0 ×•-A1 ×©×œ ×”××¨×“×•××™× ×•.'
  },
  {
    part: 1, partName: '×—×œ×§ ×¨××©×•×Ÿ â€” ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™',
    q: '××™×–×• ×ª×•×›× ×ª ×¡×™××•×œ×¦×™×” ×”×©×ª××©× ×• ×œ×“××•×ª ××ª ×”××¢×’×œ ×”×—×©××œ×™?',
    opts: [
      'Fritzing',
      'Tinkercad',
      'EasyEDA',
      'Proteus'
    ],
    correct: 1,
    explanation: '×‘× ×™×¡×•×™ ×”×©×ª××©× ×• ×‘-Tinkercad ×œ×¡×™××•×œ×¦×™×” ×©×œ ×”××¢×’×œ ×”×—×©××œ×™.'
  },
  {
    part: 1, partName: '×—×œ×§ ×¨××©×•×Ÿ â€” ×—×™×™×©×Ÿ ××¨×—×§ ×‘×¡×™×¡×™',
    q: '××” ×¤×œ×˜ ×”×ª×•×›× ×™×ª ×‘×—×œ×§ ×”×¨××©×•×Ÿ ×©×œ ×”× ×™×¡×•×™?',
    opts: [
      '×”×“×œ×§×ª LED ×‘×¢×ª ×’×™×œ×•×™ ×¢×¦×',
      '×”×©××¢×ª ×¦×œ×™×œ ×›××©×¨ ×¢×¦× ××ª×§×¨×‘',
      '×”×“×¤×¡×ª ×”××¨×—×§ ×”××ª×§×‘×œ ×¢×œ ×”××¡×š (Serial Monitor)',
      '×©××™×¨×ª × ×ª×•× ×™ ×”××¨×—×§ ×œ×›×¨×˜×™×¡ ×–×™×›×¨×•×Ÿ'
    ],
    correct: 2,
    explanation: '×‘×—×œ×§ ×”×¨××©×•×Ÿ ×”×ª×•×›× ×™×ª ××“×“×” ××¨×—×§ ×•×”×“×¤×™×¡×” ××•×ª×• ×¢×œ ×”-Serial Monitor.'
  },

  // --- PART 2: LED ×•×‘×§×¨×” ---
  {
    part: 2, partName: '×—×œ×§ ×©× ×™ â€” LED ×•×‘×§×¨×” ×œ×¤×™ ××¨×—×§',
    q: '×‘××™×–×” ×ª× ××™ ××“×œ×™×§×” ×”×ª×•×›× ×™×ª ××ª ×”-LED ×‘×—×œ×§ ×”×©× ×™?',
    opts: [
      '×›××©×¨ ×”××¨×—×§ ×’×“×•×œ ×-20 ×¡"×',
      '×›××©×¨ ×”××¨×—×§ ×§×˜×Ÿ ×-10 ×¡"×',
      '×›××©×¨ ×”××¨×—×§ ×©×•×•×” ×œ-15 ×¡"×',
      '×”-LED ×“×•×œ×§ ×ª××™×“ ×œ×œ× ×ª×œ×•×ª ×‘××¨×—×§'
    ],
    correct: 1,
    explanation: '×”×ª×•×›× ×™×ª ×‘×—×œ×§ ×”×©× ×™ ××“×œ×™×§×” LED ×›××©×¨ ×”××¨×—×§ ×”× ××“×“ ×§×˜×Ÿ ×-10 ×¡"×.'
  },
  {
    part: 2, partName: '×—×œ×§ ×©× ×™ â€” LED ×•×‘×§×¨×” ×œ×¤×™ ××¨×—×§',
    q: '×œ××™×–×” ×”×™×“×§ ×‘××¨×“×•××™× ×• ××—×‘×¨×™× ××ª ×”×¨×’×œ ×”××¨×•×›×” (×× ×•×“×”) ×©×œ ×”-LED?',
    opts: [
      '×™×©×™×¨×•×ª ×œ-GND',
      '×œ×”×™×“×§ ×“×™×’×™×˜×œ×™ ×“×¨×š × ×’×“',
      '×œ-VCC ×œ×œ× × ×’×“',
      '×œ× ××©× ×” ×œ××™×–×” ×”×™×“×§'
    ],
    correct: 1,
    explanation: '×”×× ×•×“×” (×¨×’×œ ××¨×•×›×”) ××—×•×‘×¨×ª ×œ×”×™×“×§ ×“×™×’×™×˜×œ×™ ×“×¨×š × ×’×“, ×”×§×ª×•×“×” (×¨×’×œ ×§×¦×¨×”) ×œ-GND.'
  },
  {
    part: 2, partName: '×—×œ×§ ×©× ×™ â€” LED ×•×‘×§×¨×” ×œ×¤×™ ××¨×—×§',
    q: '××“×•×¢ ×—×©×•×‘ ×œ×—×‘×¨ × ×’×“ ×‘×˜×•×¨ ×œ-LED?',
    opts: [
      '×›×“×™ ×œ×”×’×‘×™×¨ ××ª ×¢×•×¦××ª ×”××•×¨',
      '×›×“×™ ×œ×”×’×Ÿ ×¢×œ ×”-LED ×× ×–×§ ×¢×§×‘ ×–×¨× ×’×‘×•×” ××“×™',
      '×›×“×™ ×œ×™×™×¦×¨ ×ª×“×¨ ××”×‘×”×‘',
      '×›×“×™ ×œ×—×¡×•×š ×—×©××œ'
    ],
    correct: 1,
    explanation: '×”× ×’×“ ××’×‘×™×œ ××ª ×”×–×¨× ×•××•× ×¢ ×©×¨×™×¤×ª ×”-LED (LED ×¡×˜× ×“×¨×˜×™ ×“×•×¨×© ×›-20mA).'
  },
  {
    part: 2, partName: '×—×œ×§ ×©× ×™ â€” LED ×•×‘×§×¨×” ×œ×¤×™ ××¨×—×§',
    q: '××™×–×” ×¤×§×•×“×” ×‘××¨×“×•××™× ×• ××“×œ×™×§×” ××• ××›×‘×” PIN ×“×™×’×™×˜×œ×™?',
    opts: [
      'analogWrite()',
      'pinMode()',
      'digitalWrite()',
      'Serial.print()'
    ],
    correct: 2,
    explanation: '×”×¤×§×•×“×” digitalWrite(pin, HIGH/LOW) ××“×œ×™×§×” ××• ××›×‘×” ×”×™×“×§ ×“×™×’×™×˜×œ×™.'
  },
  {
    part: 2, partName: '×—×œ×§ ×©× ×™ â€” LED ×•×‘×§×¨×” ×œ×¤×™ ××¨×—×§',
    q: '××” ×›×œ×™ ×”-EasyEDA ×©×¦×•×™×Ÿ ×‘× ×™×¡×•×™?',
    opts: [
      '×›×œ×™ ×œ×›×ª×™×‘×ª ×§×•×“ ××¨×“×•××™× ×•',
      '×›×œ×™ ×œ×¦×™×•×¨ ×¡×¨×˜×•×˜×™× ×—×©××œ×™×™× (×¡×›××•×ª)',
      '×›×œ×™ ×œ×¡×™××•×œ×¦×™×” ×ª×œ×ª-×××“×™×ª ×©×œ ××¢×’×œ×™×',
      '×›×œ×™ ×œ×”×“×¤×¡×ª ×œ×•×—×•×ª PCB ×‘×œ×‘×“'
    ],
    correct: 1,
    explanation: 'EasyEDA ×”×•× ×›×œ×™ ××§×•×•×Ÿ ×œ×¦×™×•×¨ ×¡×¨×˜×•×˜×™× ×—×©××œ×™×™× (Schematics) ×•×¢×™×¦×•×‘ PCB.'
  },

  // --- PART 3: ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª ---
  {
    part: 3, partName: '×—×œ×§ ×©×œ×™×©×™ â€” ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª',
    q: '××” ×ª× ××™ ×”×¤×¢×œ×ª ×”×¦×œ×™×œ (×¨××§×•×œ) ×‘×—×œ×§ ×”×©×œ×™×©×™?',
    opts: [
      '×›××©×¨ ××¨×—×§ < 20 ×¡"×',
      '×›××©×¨ ××¨×—×§ < 10 ×¡"×',
      '×›××©×¨ ××¨×—×§ > 30 ×¡"×',
      '×›××©×¨ LED ×›×‘×•×™'
    ],
    correct: 1,
    explanation: '×‘×—×œ×§ ×”×©×œ×™×©×™: LED × ×“×œ×§ ×›×©××¨×—×§ < 20 ×¡"×, ×¨××§×•×œ ××•×¤×¢×œ ×›×©××¨×—×§ < 10 ×¡"×.'
  },
  {
    part: 3, partName: '×—×œ×§ ×©×œ×™×©×™ â€” ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª',
    q: '×‘××™×–×” ××¨×—×§ ××ª×—×™×œ ×”-LED ×œ×”×™×“×œ×§ ×‘×—×œ×§ ×”×©×œ×™×©×™?',
    opts: [
      '5 ×¡"×',
      '10 ×¡"×',
      '20 ×¡"×',
      '50 ×¡"×'
    ],
    correct: 2,
    explanation: '×‘×—×œ×§ ×”×©×œ×™×©×™ ×”-LED ××ª×—×™×œ ×œ×“×œ×•×§ ×›×©×”××¨×—×§ ×§×˜×Ÿ ×-20 ×¡"×.'
  },
  {
    part: 3, partName: '×—×œ×§ ×©×œ×™×©×™ â€” ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª',
    q: '××™×–×• ×¤×§×•×“×” ×‘××¨×“×•××™× ×• ××¤×¢×™×œ×” ×¦×œ×™×œ ×“×¨×š ×¨××§×•×œ (Buzzer)?',
    opts: [
      'playSound()',
      'tone()',
      'soundOn()',
      'beep()'
    ],
    correct: 1,
    explanation: '×”×¤×§×•×“×” tone(pin, frequency) ××¤×¢×™×œ×” ×¦×œ×™×œ ×‘×ª×“×¨ ×©× ×§×‘×¢ ×‘-Buzzer ×”××—×•×‘×¨ ×œ-pin.'
  },
  {
    part: 3, partName: '×—×œ×§ ×©×œ×™×©×™ â€” ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª',
    q: '××” ×”×§×©×¨ ×‘×™×Ÿ ×”××¢×¨×›×ª ×©×‘× ×™× ×• ×œ×—×™×™×©×Ÿ ×—× ×™×™×” ×‘×¨×›×‘?',
    opts: [
      '××™×Ÿ ×§×©×¨ â€” ×—×™×™×©×Ÿ ×”×¨×›×‘ ×¢×•×‘×“ ×©×•× ×” ×œ×—×œ×•×˜×™×Ÿ',
      '×©× ×™×”× ×××™×ª×¨×™× ×¦×‘×¢ ×©×œ ××›×©×•×œ×™×',
      '×©× ×™×”× ××©×ª××©×™× ×‘×¢×™×§×¨×•×Ÿ ×–×”×”: ×—×™×™×©×Ÿ ××¨×—×§ ×©××¤×¢×™×œ ××–×¢×§×” ×§×•×œ×™×ª ×‘-proximity',
      '×©× ×™×”× ×¢×•×‘×“×™× ×¨×§ ×‘×œ×™×œ×”'
    ],
    correct: 2,
    explanation: '×—×™×™×©×Ÿ ×”×—× ×™×™×” ×‘×¨×›×‘ ×¤×•×¢×œ ×‘××•×ª×• ×¢×™×§×¨×•×Ÿ â€” ×—×™×™×©×Ÿ ××•×œ×˜×¨×”-×¡×•× ×™ + ××–×¢×§×” ×§×•×œ×™×ª ×”××ª×’×‘×¨×ª ×›×›×œ ×©××ª×§×¨×‘×™×.'
  },
  {
    part: 3, partName: '×—×œ×§ ×©×œ×™×©×™ â€” ×¨××§×•×œ ×•××¢×¨×›×ª ××©×•×œ×‘×ª',
    q: '××” ×”×™×™×ª×” ×”××˜×¨×” ×”×¡×•×¤×™×ª ×©×œ ×”× ×™×¡×•×™ ×‘×›×œ×œ×•×ª×•?',
    opts: [
      '×‘× ×™×™×ª ×©×¢×•×Ÿ ×“×™×’×™×˜×œ×™',
      '×‘× ×™×™×ª ××¢×¨×›×ª ××“×™×“×ª ××¨×—×§ ×©××¤×¢×™×œ×” ×¤×œ×˜×™× ×©×•× ×™× (LED, ×¨××§×•×œ) ×œ×¤×™ ×¢×¨×›×™ ×¡×£',
      '×œ×™××•×“ ×©×¤×ª Python',
      '×ª×›× ×•×ª ×©×œ ×œ×•×— Arduino ×œ×œ× ×—×™×™×©× ×™×'
    ],
    correct: 1,
    explanation: '×”××˜×¨×” ×”×™× ×œ×‘× ×•×ª ××¢×¨×›×ª ×©×©×•×œ×˜×ª ×‘-LED ×•×‘×¨××§×•×œ ×¢×œ-×¤×™ ××¨×—×§ ×”× ××“×“ ×¢×œ-×™×“×™ ×—×™×™×©×Ÿ ××•×œ×˜×¨×”-×¡×•× ×™.'
  }
];

// ================== STATE ==================
let currentQ = 0;
let answers = new Array(15).fill(null);
let studentName = '';
let startTime;

// ================== PARTICLES ==================
(function createParticles() {
  const container = document.getElementById('particles');
  const colors = ['#00d4ff', '#7c3aed', '#10b981'];
  for (let i = 0; i < 12; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 4 + 2;
    p.style.cssText = `
      width:${size}px;height:${size}px;
      left:${Math.random()*100}%;
      background:${colors[i%3]};
      animation-duration:${15+Math.random()*20}s;
      animation-delay:${Math.random()*15}s;
    `;
    container.appendChild(p);
  }
})();

// ================== INIT ==================
document.getElementById('studentName').addEventListener('input', function() {
  document.getElementById('startBtn').disabled = this.value.trim().length < 2;
});
document.getElementById('studentName').addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && this.value.trim().length >= 2) startQuiz();
});

function startQuiz() {
  studentName = document.getElementById('studentName').value.trim();
  if (!studentName) return;
  startTime = new Date();
  currentQ = 0;
  answers = new Array(15).fill(null);
  showScreen('screen-quiz');
  renderQuestion();
}

// ================== QUIZ ==================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function renderQuestion() {
  const q = questions[currentQ];
  const total = questions.length;
  const pct = ((currentQ) / total) * 100;

  document.getElementById('progressBar').style.width = pct + '%';
  document.getElementById('progressText').textContent = `×©××œ×” ${currentQ+1} ××ª×•×š ${total}`;
  document.getElementById('sectionText').textContent = q.partName;

  const isAnswered = answers[currentQ] !== null;
  const letters = ['×', '×‘', '×’', '×“'];

  const sectionClass = `section-${q.part}`;
  const html = `
    <div class="${sectionClass}">
      <div class="section-header">
        <div class="section-num">${q.part}</div>
        <div class="section-info">
          <h3>${q.partName}</h3>
          <p>×©××œ×•×ª ${(q.part-1)*5+1}â€“${q.part*5}</p>
        </div>
      </div>
      <div class="question-card">
        <div class="q-number"><div class="q-dot"></div>×©××œ×” ${currentQ+1}</div>
        <div class="question-text">${q.q}</div>
        <div class="options-grid">
          ${q.opts.map((opt, i) => {
            let cls = 'option-btn';
            if (isAnswered) {
              cls += ' disabled-look';
              if (i === q.correct) cls += ' correct';
              else if (i === answers[currentQ]) cls += ' wrong';
            }
            // Detect if option contains English/code (functions, class names, etc.)
            const isLtr = /^[a-zA-Z_()\[\]0-9.\/\-+*=<>!&|%, ]+$/.test(opt.trim()) || /[a-zA-Z]{3,}\(/.test(opt);
            const spanCls = isLtr ? 'opt-ltr' : '';
            return `<button class="${cls}" onclick="selectAnswer(${i})" ${isAnswered?'disabled':''}>
              <span class="opt-letter">${letters[i]}</span>
              <span class="${spanCls}">${opt}</span>
            </button>`;
          }).join('')}
        </div>
        ${isAnswered ? `
        <div class="feedback ${answers[currentQ]===q.correct?'correct':'wrong'} show">
          ${answers[currentQ]===q.correct?'âœ…':'âŒ'} ${q.explanation}
        </div>` : ''}
      </div>
    </div>
  `;
  document.getElementById('quizContent').innerHTML = html;
  document.getElementById('nextBtn').disabled = !isAnswered;

  const isLast = currentQ === total - 1;
  document.getElementById('nextBtn').textContent = isLast ? '×¡×™×™× ××‘×—×Ÿ ğŸ' : '×”××©×š â†’';
}

function selectAnswer(idx) {
  if (answers[currentQ] !== null) return;
  answers[currentQ] = idx;
  renderQuestion();
  document.getElementById('nextBtn').disabled = false;
}

function nextQuestion() {
  if (currentQ < questions.length - 1) {
    currentQ++;
    renderQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else {
    showResults();
  }
}

// ================== RESULTS ==================
function showResults() {
  showScreen('screen-results');
  const correct = answers.filter((a, i) => a === questions[i].correct).length;
  const total = questions.length;
  const score = Math.round((correct / total) * 100);
  const wrong = total - correct;

  document.getElementById('scoreNum').textContent = score;
  document.getElementById('scorePercent').textContent = score + '%';
  document.getElementById('scoreCorrect').textContent = correct;
  document.getElementById('scoreWrong').textContent = wrong;

  // Animate ring
  const ring = document.getElementById('scoreRing');
  const circumference = 440;
  const offset = circumference - (score / 100) * circumference;
  const color = score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : '#ef4444';
  ring.style.stroke = color;
  setTimeout(() => { ring.style.strokeDashoffset = offset; }, 100);

  let emoji, title, sub;
  if (score >= 90) { emoji='ğŸ†'; title='××¦×•×™×Ÿ! ×‘×™×¦×•×¢ ××•×©×œ×!'; sub='×©×œ×™×˜×” ××œ××” ×‘×—×•××¨ â€” ×›×œ ×”×›×‘×•×“!'; }
  else if (score >= 80) { emoji='â­'; title='×›×œ ×”×›×‘×•×“!'; sub='×‘×™×¦×•×¢ ×˜×•×‘ ×××•×“, ×××© ×§×¨×•×‘ ×œ×©×œ××•×ª.'; }
  else if (score >= 70) { emoji='ğŸ‘'; title='×¢×‘×•×“×” ×˜×•×‘×”!'; sub='×ª×•×¦××” × ××”, ×›×“××™ ×œ×—×–×•×¨ ×¢×œ ×”× ×•×©××™× ×©×”×ª×§×©×™×ª ×‘×”×.'; }
  else if (score >= 60) { emoji='ğŸ“š'; title='×™×© ××” ×œ×©×¤×¨'; sub='×—×–×•×¨/×™ ×¢×œ ×”× ×•×©××™× ×©× ×›×©×œ×ª ×‘×”× ×•× ×¡×”/×™ ×©×•×‘.'; }
  else { emoji='ğŸ’ª'; title='×¦×¨×™×š ×œ×—×–×•×¨ ×¢×œ ×”×—×•××¨'; sub='×”××©×š/×™ ×œ×ª×¨×’×œ â€” ××ª×”/××ª ×™×›×•×œ/×”!'; }

  document.getElementById('resultsTitle').textContent = `${emoji} ${title}`;
  document.getElementById('resultsSubtitle').textContent = sub;

  // Review
  let reviewHTML = '<h3>×¡×§×™×¨×ª ×ª×©×•×‘×•×ª</h3>';
  questions.forEach((q, i) => {
    const isRight = answers[i] === q.correct;
    reviewHTML += `
      <div class="review-item ${isRight ? 'review-correct' : 'review-wrong'}">
        <span class="review-icon">${isRight ? 'âœ…' : 'âŒ'}</span>
        <div class="review-q">
          <div class="q-label">×©××œ×” ${i+1} â€” ${q.partName}</div>
          ${q.q}
        </div>
      </div>`;
  });
  document.getElementById('answersReview').innerHTML = reviewHTML;
}

// ================== EXCEL EXPORT ==================
function exportToExcel() {
  const now = new Date();
  const dateStr = now.toLocaleDateString('he-IL') + ' ' + now.toLocaleTimeString('he-IL', {hour:'2-digit',minute:'2-digit'});
  const correct = answers.filter((a, i) => a === questions[i].correct).length;
  const score = Math.round((correct / questions.length) * 100);

  const row = { '×©×': studentName, '×ª××¨×™×š': dateStr };
  answers.forEach((a, i) => {
    const letters = ['×', '×‘', '×’', '×“'];
    row[`×©××œ×” ${i+1}`] = a !== null ? letters[a] : 'â€”';
  });
  row['×¦×™×•×Ÿ'] = score + '%';

  const ws = XLSX.utils.json_to_sheet([row]);

  // Style column widths
  ws['!cols'] = [
    {wch:20}, {wch:18},
    ...Array(15).fill({wch:10}),
    {wch:10}
  ];

  // RTL
  ws['!dir'] = 'rtl';

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, '×ª×•×¦××•×ª ××‘×—×Ÿ');

  const fileName = `××‘×—×Ÿ_×—×™×™×©×Ÿ_××¨×—×§_${studentName.replace(/\s+/g,'_')}_${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}.xlsx`;
  XLSX.writeFile(wb, fileName);
}
</script>
</body>
</html>
